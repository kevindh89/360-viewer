!function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return t[s].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("alongpath",{schema:{path:{"default":""},closed:{"default":!1},dur:{"default":1e3},delay:{"default":0},loop:{"default":!1},rotate:{"default":!1},inspect:{"default":!1}},init:function(){this.initialPosition=this.el.getAttribute("position")},update:function(t){t.path&&t.path==this.data.path||(this.curve=null,this.createCurve()),this.data.inspect&&this.curve?(t.inspect&&t.inspect!==!1||(this.inspectorElementChanged=this.inspectorElementChanged.bind(this),this.createInspectorElements()),this.drawCurveLine(),this.synchInspectorElementPosition()):t.inspect===!0&&this.removeInspectorElements()},createCurve:function(){if(this.pathpoints=this.data.path.split(" ").map(function(t){return t=t.split(","),new THREE.Vector3(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))}),this.pathpoints.length>=2){var t=new THREE.CatmullRomCurve3(this.pathpoints);t.closed=this.data.closed,this.curve=t}else console.warn("The path needs at least 2 path-points!");this.interval=0,this.el.removeState("endofpath")},tick:function(t,e){if(this.curve&&!this.el.is("endofpath")){this.interval=this.interval+e;var i=0;if(i=this.interval-this.data.delay>=this.data.dur?1:this.interval-this.data.delay<0?0:(this.interval-this.data.delay)/this.data.dur,this.data.loop===!1&&i>=1)this.el.removeState("moveonpath"),this.el.addState("endofpath"),this.el.emit("movingended"),this.data.closed?this.el.setAttribute("position",this.curve.points[0]):this.el.setAttribute("position",this.curve.points[this.curve.points.length-1]);else if(this.data.loop===!0&&i>=1)this.el.emit("movingended"),this.interval=this.data.delay;else{this.el.is("moveonpath")||(this.el.addState("moveonpath"),this.el.emit("movingstarted"));var s=this.curve.getPoint(i);this.el.setAttribute("position",s)}if(this.data.rotate===!0){var n=new THREE.Vector3,o=new THREE.Vector3(0,1,0),r=this.curve.getTangentAt(i).normalize();n.crossVectors(o,r).normalize();var a=Math.acos(o.dot(r));this.el.object3D.quaternion.setFromAxisAngle(n,a)}}},remove:function(){this.el.setAttribute("position",this.initialPosition),this.removeInspectorElements()},createInspectorElements:function(){this.removeInspectorElements();var t=document.querySelector(".alongpath-debug-root");if(!t){var e=document.createElement("a-entity");t=this.el.sceneEl.appendChild(e),t.setAttribute("class","alongpath-debug-root")}this.inspectorRootElement=t,this.inspectorElements=new Array;for(var i=0;i<this.pathpoints.length;i++){var s=document.createElement("a-box"),n=this.inspectorRootElement.appendChild(s);AFRAME.utils.entity.setComponentProperty(n,"position",AFRAME.utils.coordinates.stringify(this.pathpoints[i])),AFRAME.utils.entity.setComponentProperty(n,"width",.1),AFRAME.utils.entity.setComponentProperty(n,"height",.1),AFRAME.utils.entity.setComponentProperty(n,"depth",.1),AFRAME.utils.entity.setComponentProperty(n,"color","red"),n.setAttribute("class","alongpath-debug"),n.setAttribute("visible",!0),n.addEventListener("componentchanged",this.inspectorElementChanged),this.inspectorElements.push(n)}this.drawCurveLine()},drawCurveLine:function(){this.inspectorCurve&&this.inspectorCurve.parentNode.removeChild(this.inspectorCurve);var t=document.createElement("a-entity"),e=this.inspectorRootElement.appendChild(t),i=new THREE.LineBasicMaterial({color:"red"}),s=new THREE.Geometry;s.vertices=this.curve.getPoints(10*this.pathpoints.length),e.setObject3D("mesh",new THREE.Line(s,i)),e.setAttribute("className","alongpath-debug"),e.setAttribute("visible",!0),this.inspectorCurve=e},removeInspectorElements:function(){if(this.inspectorElements)for(var t=0;t<this.inspectorElements.length;t++)this.inspectorElements[t].parentNode.removeChild(this.inspectorElements[t]);this.inspectorCurve&&this.inspectorCurve.parentNode.removeChild(this.inspectorCurve),this.inspectorRootElement&&(this.inspectorRootElement.childNodes&&0!=this.inspectorRootElement.childNodes.length||(this.inspectorRootElement.parentNode&&this.inspectorRootElement.parentNode.removeChild(this.inspectorRootElement),this.inspectorRootElement=null)),this.inspectorElements=null,this.inspectorCurve=null},synchInspectorElementPosition:function(){for(var t=0;t<this.pathpoints.length;t++)this.inspectorElements[t]&&AFRAME.utils.entity.setComponentProperty(this.inspectorElements[t],"position",AFRAME.utils.coordinates.stringify(this.pathpoints[t]))},inspectorElementChanged:function(t){for(var e=new Array,i=0;i<this.inspectorElements.length;i++)this.inspectorElements[i].components.position.attrValue&&e.push(this.inspectorElements[i].components.position.attrValue.x+","+this.inspectorElements[i].components.position.attrValue.y+","+this.inspectorElements[i].components.position.attrValue.z);var s=e.join(" ");""!=s&&s!=this.data.path&&AFRAME.utils.entity.setComponentProperty(this.el,"alongpath.path",s)}})}]);